webpackJsonp([0],[,function(e,t,n){"use strict";function i(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}var a=function(){function e(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(t,n,i){return n&&e(t.prototype,n),i&&e(t,i),t}}(),r=n(0),o=n(3),l=o.urls.API_FANG_PUB,s=function(){function e(t){i(this,e),this.localVersion=t,this.currentPage=0,this.weiboData=[],this.overTime=0,this.getReadCount()}return a(e,[{key:"getUID",value:function(){return r.ajax({url:"https://weibo.com/",type:"get"})}},{key:"getFansHTML",value:function(e){var t=e.match(/FM.view\({"ns":"pl.rightmod.myinfo.index"[\S\s]+?}\)/),n="",i="\u83b7\u53d6\u4e0d\u5230",a="\u83b7\u53d6\u4e0d\u5230",o="\u83b7\u53d6\u4e0d\u5230";if(t){var l=t[0].match(/"html":"([\s\S]+)"}\)/);if(l){n=l[1].replace(/\\t/g,"").replace(/\\r/g,"").replace(/\\n/g,"").replace(/\\/g,"");var s=r(n);i=s.find('[node-type="fans"]').text(),a=s.find('[node-type="follow"]').text(),o=s.find('[node-type="weibo"]').text()}return r.Deferred().resolve({fans:i,follow:a,weibo:o})}return this.page_id=new RegExp(/\$CONFIG\[\'page_id\'\]=\'+([^\s'";]*)/g).exec(e)[1],r.ajax({url:"https://weibo.com/p/"+this.page_id+"/home"}).then(function(e){var t=e.match(/FM.view\({"ns":"","domid":"Pl_Core_T8CustomTriColumn__3"[\S\s]+?}\)/);if(t){var l=t[0].match(/"html":"([\s\S]+)"}\)/);if(l){n=l[1].replace(/\\t/g,"").replace(/\\r/g,"").replace(/\\n/g,"").replace(/\\/g,"");var s=r(n),c=s.find("strong");i=c.eq(1).text(),a=c.eq(0).text(),o=c.eq(2).text()}return r.Deferred().resolve({fans:i,follow:a,weibo:o})}})}},{key:"getReadCount",value:function(){var e=this;this.getUID().then(function(t){e.uid=new RegExp(/\$CONFIG\[\'uid\'\]=\'+(\d*)/g).exec(t),e.nick=new RegExp(/\$CONFIG\[\'nick\'\]=\'+([^\s'";]*)/g).exec(t),e.uid&&e.nick&&(e.uid=e.uid[1],e.nick=e.nick[1],e.getFansHTML(t).then(function(t){e.fans=t.fans,e.follow=t.follow,e.weibo=t.weibo,e.checkStatus().then(function(t){t.code?(e.overTime=t.overTime,e.getWeiboData()):console.log(t)})}).catch(function(e){console.log(e)}))})}},{key:"checkStatus",value:function(){var e=this.uid;return r.ajax({url:l+"/wb/checkstatus",type:"post",data:{uid:e}})}},{key:"getParam",value:function(e){var t={ajwvr:6,domain:100505,topnav:1,wvr:6,is_all:1,pagebar:0,pl_name:"Pl_Official_MyProfileFeed__20",id:"100505"+e,script_uri:"/"+e+"/profile",feed_type:0,page:1,pre_page:0,domain_op:100505,__rnd:(new Date).getTime()};return this.currentPage++,this.currentPage%3==1?(t.pagebar=0,t.pre_page=0):this.currentPage%3==2?(t.pagebar=0,t.pre_page=Math.ceil(this.currentPage/3)):this.currentPage%3==0&&(t.pagebar=1,t.pre_page=Math.ceil(this.currentPage/3)),t.page=Math.ceil(this.currentPage/3),t}},{key:"getWeiboData",value:function(){var e=this,t=this.uid;r.ajax({url:"https://weibo.com/p/aj/v6/mblog/mbloglist",type:"get",data:this.getParam(t)}).done(function(t){e.handleHTML(t)})}},{key:"handleHTML",value:function(e){var t,n=(new Date).getTime(),i="<div>"+e.data+"</div>",a=r(i),o=[],l=(new Date).getFullYear();a.find(".WB_cardwrap.WB_feed_type").each(function(e,t){var n=r(t),i=n.find('[node-type="feed_list_item_date"]').attr("href");i&&(i=i.split("?")[0]);var a=n.find('[node-type="feed_list_item_date"]').text();if(a){if(/\u6708/.test(a)&&(a=l+"-"+a.replace(/\u6708/,"-").replace(/\u65e5|^\s*/g,"")),/\u4eca\u5929/.test(a)){var s=new Date,c=s.getFullYear().toString(),u=(s.getMonth()+1).toString(),g=s.getDate().toString();a=a.replace(/\u4eca\u5929/,c+"-"+u+"-"+g)}if(/\u6628\u5929/.test(a)){var f=new Date,p=f.getTime();f.setTime(p-864e5);var d=f.getFullYear().toString(),h=(f.getMonth()+1).toString(),m=f.getDate().toString();a=a.replace(/\u4eca\u5929/,d+"-"+h+"-"+m)}}var v=n.find("i.S_txt2");v=v.length>1?r.trim(v.eq(1).text().replace(/\u9605\u8bfb/,"").replace(/\u63a8\u5e7f/,"")):r.trim(v.text().replace(/\u9605\u8bfb/,"").replace(/\u63a8\u5e7f/,""));o.push({html:function(e){if(null!==e&&""!==e){for(var t=new RegExp("[`~!@#$^&*()=|{}':;',\\[\\].<>/?~@#\uffe5\u2026\u2026&*&mdash;\u2014|]"),n="",i=0;i<e.length;i++)n+=e.substr(i,1).replace(t,"");return n||"\u65e0\u6c49\u5b57"}return"\u65e0\u6c49\u5b57"}(r.trim(n.find('[node-type="feed_list_content"]').text())),count:v,time:a,link:i})}),(t=this.weiboData).push.apply(t,o);(new Date).getTime();if(!this.isOverTime(o[o.length-1]))return this.getWeiboData();var s={nickname:this.nick,uid:this.uid,info:JSON.stringify({fans:this.fans,follow:this.follow,weibo:this.weibo}),plugin_version:this.localVersion,data:JSON.stringify(this.weiboData)};console.log(s),this.sendData(s)}},{key:"isOverTime",value:function(e){var t=e.time;return(new Date).getTime()-new Date(t).getTime()>this.overTime}},{key:"sendData",value:function(e){r.ajax({url:l+"/wb/readcount",type:"post",data:e}).done(function(e){console.log(e)}).fail(function(e){console.log(e)})}}]),e}();e.exports=s},function(e,t,n){"use strict";var i=n(1);chrome.runtime.onMessage.addListener(function(e,t,n){"weiboReadCount"===e.operation&&new i("0.2.4")})},function(e,t,n){"use strict";e.exports=function(e){return{urls:{API_FANG_PUB:"http://pub.dmp.fang.com"}}}(window)}],[2]);